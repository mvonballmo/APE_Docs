<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Mobile App Entwicklung, Lektion 05: Hybrid-Apps</title>

  <link rel="stylesheet" href="dist/reset.css">
  <link rel="stylesheet" href="dist/reveal.css">
  <link rel="stylesheet" href="dist/theme/white.css">
  <link rel="stylesheet" href="slides.css">

  <!-- Theme used for syntax highlighted code -->
  <link rel="stylesheet" href="plugin/highlight/github.css">
</head>

<body>
  <div class="reveal">
    <div class="slides">
      <section data-background="assets/MonteRosa.jpg" class="white-text">
        <h1>Mobile App Entwicklung</h1>
        <h2>Lektion 5</h2>
        <p>
          Hybrid-Apps
        </p>
      </section>

      <section data-background="assets/looking-back-dimmed.jpg">
        <h1>Rückblick</h1>
        <ul>
          <li>Einführung Android</li>
          <li>Benachrichtigungen
            <ul>
              <li><a href="https://docs.microsoft.com/en-us/xamarin/android/app-fundamentals/notifications/local-notifications">Lokal</a></li>
              <li><a href="https://docs.microsoft.com/en-us/xamarin/android/data-cloud/google-messaging/firebase-cloud-messaging">Push/Remote</a></li>
            </ul>
          </li>
        </ul>
      </section>

      <section>
        <h1>Übersicht Lektionen</h1>
        <ol class="compact">
          <li class="completed">Vorstellung, Einführung und Aufsetzen von Werkzeugen</li>
          <li class="completed">MVVM, Bindings, Controls, Debugging</li>
          <li class="completed">Dialogs, Styling, IOC, Testing</li>
          <li class="completed">Benachrichtigungen (Lokal/Push/Remote)</li>
          <li class="selected">Hybrid-Apps</li>
          <li>Datenbanken (SQLite); HTTP Client</li>
          <li>Security &amp; Biometrie</li>
          <li><b>LK1</b>; Projektarbeit</li>
          <li><b>MLZ Präsentationen</b>; Themen nach Wahl</li>
        </ol>
      </section>

      <section>
        <h1>Ablauf der Lektion</h1>
        <ul>
          <li>Übersicht: Hybrid Applikationen</li>
          <li>Interoperabilität mit dem nativen Teil
            <ul>
              <li>Schnittstelle zwischen Web und nativem Code entwerfen</li>
              <li>Kleines Beispiel implementieren</li>
              <li>Ansatz präsentieren</li>
            </ul>
          </li>
        </ul>
      </section>

      <section class="compact">
        <h1>Vorteile</h1>
        <ul>
          <li>Hybrid-Ansatz ist etwa 50% des Markts (obwohl dies schwer zu beweisen ist)</li>
          <li>Auch Mobile Web Browsers unterstützen die modernste HTML/CSS/JS APIs</li>
          <li>Erlaubt Plattformunabhängiges Entwickeln für iOS, Android, und Desktop-Web gleichzeitig</li>
          <li>Es ist leichter Web- als iOS/Android Entwickler zu finden</li>
          <li>Aktualisieren der App kann ohne Store-Update statt finden</li>
        </ul>
      </section>

      <section>
        <h1>Nachteile</h1>
        <ul>
          <li>Wirkt nicht immer so fliesend wie natives Code (obwohl das wird mit neueren Releases immer besser)</li>
          <li>Man muss trotzdem beide API-Welten verstehen (Native &amp; Web)
            <ul>
              <li>Bei natives Code nicht so tiefgehend</li>
              <li>Hingegen bei Web-Entwicklung schon</li>
            </ul>
          </li>
        </ul>
      </section>

      <section class="compact">
        <h1>Umsetzung</h1>
        <ul>
          <li>Natives Teil deklariert ein JavaScript-API</li>
          <li>Web Browser kann den nativen Teil "antworten"</li>
          <li>Web kann mit Nativen Komponenten kombiniert werden (z.B. für Sicherheitsrelevanten Eingaben wie PINs)</li>
        </ul>
      </section>

      <section>
        <h1>WebView Komponenten</h1>
        <ul>
          <li><em>Xamarin</em> bietet ein eigenes WebView an. Siehe:
            <ul>
              <li><a href="https://docs.microsoft.com/en-us/xamarin/xamarin-forms/user-interface/webview?tabs=windows">Xamarin.Forms WebView</a></li>
              <li><a href="https://docs.microsoft.com/en-us/xamarin/xamarin-forms/app-fundamentals/custom-renderer/hybridwebview">Customizing a WebView</a></li>
            </ul>
          </li>
          <li>Auf natives <em>iOS</em>, <code><a href="https://developer.apple.com/documentation/webkit/wkwebview">WKWebView</a></code> einsetzen (<code>UIWebView</code> <em>nicht</em> einsetzen)</li>
          <li>Auf natives <em>Android</em>, <code><a href="https://developer.android.com/reference/android/webkit/WebView">WebView</a></code> einsetzen (seit API19 wird diese Komponente unabhängig vom Betriebssystem aktualisiert)</li>
        </ul>
      </section>

      <section class="compact">
        <h1>WebView Details</h1>
        <ul>
          <li>Die Kontrolle ist ein Umhüllung um ein eigenes Prozess</li>
          <li>Man kann auch mehrere WebViews einsetzen</li>
          <li>HTML-Seiten können entweder aus App-Ressourcen oder von Remote-URLs geladen werden</li>
          <li>CORS muss wie immer berücksichtigt werden</li>
        </ul>
      </section>

      <section class="compact">
        <h1>Hybrid Architecture</h1>
        <img src="assets/Lesson05/Hybrid_Architecture.jpg" class="tall-screenshot">
      </section>

      <section class="compact">
        <h1>Hybrid-Beispiel</h1>
        <ul>
          <li>Beispiel-Implementation in <code>APE2021_App</code></li>
          <li>Branch: <code>feature/day5_hybrid_apps</code></li>
          <li>Verzeichnis: <code>/Hybrid</code></li>
          <li>Umsetzung: Xamarin mit nur Android</li>
        </ul>
      </section>

      <section>
        <h1>JS-Schnittstelle deklarieren</h1>
        <pre>
          <code data-trim class="language-csharp hljs">
            public class JavaScriptInject : Object {
              /// <summary>
              /// Annotate methods with the <see cref="JavascriptInterfaceAttribute"/> and   /// the <see cref="ExportAttribute"/> to call them from JS.
              /// </summary>
              [JavascriptInterface]
              [Export("doSomething")]
              public void FromJavaScript() { /* ... */ }

              /// <summary>
              /// Annotated methods can also accept parameters.
              /// </summary>
              [JavascriptInterface]
              [Export("doSomething")]
              public void FromJavaScript(string message) { /* ... */ }
            }
          </code>
        </pre>
      </section>

      <section>
        <h1>JS-Schnittstelle registrieren</h1>
        <pre>
          <code data-trim class="language-csharp hljs">
            // Set the content layout which contains a simple web view.
            SetContentView(Resource.Layout.activity_main);

            // Extract the web view from the layout.
            var webView = (WebView)FindViewById(Resource.Id.webView);

            // Configure WebView to allow JS and inject our custom interface.
            webView.Settings.JavaScriptEnabled = true;
            webView.AddJavascriptInterface(new JavaScriptInject(this), "Native");

            // Load a local HTML file.
            webView.LoadUrl("file:///android_asset/index.html");
          </code>
        </pre>
      </section>

      <section>
        <h1>WebView -> Native</h1>
        <p>Mit <code>Native.doSomething()</code> ausführen</p>
        <pre>
          <code data-trim class="language-html hljs">
            &lt;input type="button" onclick="Native.doSomething()" value="Invoke native" /&gt;
          </code>
        </pre>
        <p>...oder mit Parametern ausführen</p>
        <pre>
          <code data-trim class="language-html hljs">
            &lt;input type="button" onclick="Native.doSomething('Another message...')" value="Invoke native with param" /&gt;
          </code>
        </pre>
      </section>

      <section>
        <h1><a href="https://docs.microsoft.com/en-gb/dotnet/api/android.webkit.webview.evaluatejavascript">Native -> WebView</a></h1>
        <pre>
          <code data-trim class="language-csharp hljs">
            webView.EvaluateJavascript("do some JS magic...", null);

            public class Callback : Java.Lang.Object, IValueCallback
            {
              public void OnReceiveValue(Object value)  {
                // Do something with the value...
              }
            }

            webView.EvaluateJavascript("do some JS magic...", new Callback());
          </code>
        </pre>
      </section>

      <section>
        <div class="seventy-thirty-grid">
          <div>
            <h1>Hybrid-App</h1>
            <ul class="compact">
              <li>Native -> Web</li>
              <li>Web -> Native</li>
            </ul>
          </div>
          <img src="assets/demo.png">
        </div>
      </section>

      <section>
        <h1>Fragen?</h1>
        <div class="fifty-fifty-grid">
          <img src="assets/okaaaay.jpg">
        </div>
      </section>

      <section>
        <div class="seventy-thirty-grid">
          <div>
            <h1>Übungen</h1>
            <ul>
              <li>Element selektieren und dessen Inhalt anpassen</li>
              <li>Daten vom Server abfragen und einem Dokument hinzufügen</li>
            </ul>
          </div>
          <img src="assets/cog-wheels.png">
        </div>
      </section>

      <section data-background="assets/macro-focus-cogwheel-gear-159275-dimmed.jpg">
        <h1><a href="https://developer.mozilla.org/docs/Web/Events#standard_events">Ereignisse</a></h1>
        <p>Hier geht es um Ereignisse aus der Laufzeitumgebung abzufangen und darauf zu reagieren.</p>
        <ul>
          <li>Beispiele</li>
          <li>Abfangen</li>
          <li>Reihenfolge</li>
          <li>Unterdrücken</li>
        </ul>
      </section>

      <section>
        <h1>Ereignisse: Generell</h1>
        <table>
          <tr>
            <th><a href="https://developer.mozilla.org/docs/Web/API/GlobalEventHandlers/onclick">onclick</th>
            <td>Element wurde geklickt</td>
          </tr>
          <tr>
            <th><a href="https://developer.mozilla.org/docs/Web/API/GlobalEventHandlers/onmouseenter">onmouseenter
            </th>
            <td>Maus schwebte über das Element</td>
          </tr>
          <tr>
            <th><a href="https://developer.mozilla.org/docs/Web/API/GlobalEventHandlers/onmouseleave">onmouseleave
            </th>
            <td>Maus schwebte weg vom Element</td>
          </tr>
          <tr>
            <th><a href="https://developer.mozilla.org/docs/Web/API/GlobalEventHandlers/onkeypress">onkeypress
            </th>
            <td>Taste wurde betätigt</td>
          </tr>
          <tr>
            <th><a href="https://developer.mozilla.org/docs/Web/API/GlobalEventHandlers/oninput">oninput</th>
            <td>Wert wurde geändert</td>
          </tr>
        </table>
        <p class="notes">Siehe <a href="https://developer.mozilla.org/docs/Web/API/GlobalEventHandlers">GlobalEventHandlers</a> für eine
          vollständige Liste.</p>
      </section>

      <section class="compact">
        <h1>Ereignisse: Laden</h1>
        <table>
          <tr>
            <th>Name</th>
            <th>Beschreibung</th>
            <th>Target</th>
          </tr>
          <tr>
            <th><a href="https://developer.mozilla.org/docs/Web/API/Window/load_event">onload</th>
            <td>Alle Ressourcen eines URLs wurden fertig geladen</td>
            <td><code>window</code></td>
          </tr>
          <tr>
            <th><a href="https://developer.mozilla.org/docs/Web/API/Document/DOMContentLoaded_event">DOMContentLoaded</th>
            <td>Dokument wurde fertig geladen</td>
            <td><code>document</code></td>
          </tr>
        </table>
        <p class="notes">Siehe <a href="https://developer.mozilla.org/docs/Web/API/Document">document</a> und
          <a href="https://developer.mozilla.org/docs/Web/API/Window">window</a> für eine
          vollständige Liste.
        </p>
      </section>

      <section>
        <h1><a href="https://developer.mozilla.org/docs/Web/Events/Event_handlers">Ereignisse</a> abfangen</h1>
        <ul>
          <li>Ereignisse werden vom Browser ausgelöst.</li>
          <li>Z.B. Mausklicks oder -bewegungen, Wert-Änderungen, usw.</li>
          <li>Mögliche Ereignisbehandlungsmethoden:
            <ul>
              <li>🤨 Attribut auf dem Element</li>
              <li>🤨 EventHandler</li>
              <li>😎 EventListener</li>
            </ul>
          </li>
        </ul>
      </section>

      <section>
        <h1>Ereignisobjekt</h1>
        <table>
          <tr>
            <th><code>target</code></th>
            <td>Auslösendes Element</td>
          </tr>
          <tr>
            <th><code>currentTarget</code></th>
            <td>Element mit EventHandler</td>
          </tr>
          <tr>
            <th><code>timeStamp</code></th>
            <td>Zeitpunkt des Ereignisses</td>
          </tr>
          <tr>
            <th><code>view</code></th>
            <td>Referenz auf <code>window</code> (oder <code>frame</code>)</td>
          </tr>
          <tr>
            <th><code>offsetX</code>/<code>offsetY</code></th>
            <td>relative Mausposition</td>
          </tr>
        </table>
      </section>

      <section>
        <h1><code>onclick</code> Attribut</h1>
        <ul>
          <li>😎 Ist klar welcher Script ausgeführt wird</li>
          <li>🤨 Wird im globalen Kontext ausgeführt</li>
          <li>🤨 Mischt Darstellung mit Logik</li>
          <li>🤨 Führt zu dupliziertem Code</li>
          <li>🤨 Obsoleter Zugriff auf dem Ereignisobjekt</li>
        </ul>
        <pre>
          <code data-trim class="language-html hljs">
            <button onclick="console.log(this.id)" id="a">Log Value</button>
            <button onclick="console.log(this.id)" id="b">Log Value</button>
          </code>
        </pre>
      </section>

      <section>
        <h1><code>onclick</code> EventHandler</h1>
        <ul>
          <li>😎 Wird im Funktionskontext ausgeführt</li>
          <li>😎 Darstellung und Logik sind separat</li>
          <li>😎 Meidet dupliziertes Code</li>
          <li>🤨 Überschreibt andere <em>EventHandlers</em></li>
        </ul>
        <pre>
          <code data-trim class="language-html hljs">
            <button id="a">Log Value</button>
            <button id="b">Log Value</button>
          </code>
        </pre>
        <pre>
          <code data-trim class="language-javascript hljs">
            const buttons = document.getElementsByTagName("button");
            for (const button of buttons) {
              button.onclick = e => console.log(e.target.id);
            }
          </code>
        </pre>
      </section>

      <section>
        <h1><code>click</code> EventListener</h1>
        <ul>
          <li>😎 Wird im Funktionskontext ausgeführt</li>
          <li>😎 Darstellung und Logik sind separat</li>
          <li>😎 Meidet dupliziertes Code</li>
          <li>😎 Lässt andere <em>EventListeners</em> stehen</li>
        </ul>
        <pre>
          <code data-trim class="language-html hljs">
            <button id="a">Log Value</button>
            <button id="b">Log Value</button>
          </code>
        </pre>
        <pre>
          <code data-trim class="language-javascript hljs">
            const buttons = document.getElementsByTagName("button");
            for (const button of buttons) {
              button.addEventListener("click", e => console.log(e.target.id));
            }
          </code>
        </pre>
      </section>

      <section>
        <h1 class="insertion">Funktionen und <code>this</code></h1>
        <table>
          <tr>
            <th><code>function</code></th>
            <td><code>this</code> referenziert das Ereignis&shy;element</td>
          </tr>
          <tr>
            <th><code>=></code></th>
            <td><code>this</code> referenziert das umliegende Kontext
              <table>
                <tr>
                  <th>im Dokument</th>
                  <td><code>window</code></td>
                </tr>
                <tr>
                  <th>im Modul</th>
                  <td><code>undefined</code></td>
                </tr>
              </table>
            </td>
          </tr>
        </table>
      </section>

      <section>
        <h1>EventListener: Entfernen</h1>
        <ul>
          <li>Listeners können mit <code>removeEventListener()</code> entfernt werden</li>
          <li>Dazu ist eine fixe Referenz nötig (z.B. eine Funktion)</li>
        </ul>
        <pre>
          <code data-trim class="language-javascript hljs">
            const logId = e => console.log(e.target.id);
            const button = document.getElementById("a");
            button.addEventListener("click", logId);
            button.removeEventListener("click", logId);
          </code>
        </pre>
      </section>

      <section>
        <h1 class="insertion">Funktionen: Kurzform</h1>
        <p>Bei einer benannten Funktion kann man das auflisten von Parametern weglassen, wenn die Parameter einfach
          weitergegeben werden sollen.</p>
        <pre>
          <code data-trim class="language-javascript hljs">
            const log = e => console.log(e);

            // Die folgende Aufrufe sind Equivalent
            document.AddEventListener("click", e => console.log(e))
            document.addEventListener("click", e => log(e));
            document.addEventListener("click", log);
          </code>
        </pre>
      </section>

      <section>
        <h1>Event Reihenfolge</h1>
        <ul>
          <li>Normalerweise werden Ereignisse bei allen "Parent"-Elementen ausgelöst</li>
          <li>In <code>addEventListener</code> kann man mit dem Setzen des dritten Parameters <code>capture</code> auf
            <code>true</code> sicherstellen, dass das Ereignis zuerst bei diesem Element ausgelöst wird.
          </li>
          <li>Mit <code>stopPropagation()</code> kann man das <em>propagieren</em> verhindern</li>
        </ul>
      </section>

      <section>
        <h1><a href="https://www.w3.org/TR/DOM-Level-3-Events/#event-flow">Event Flow</a></h1>
        <p>"Capture" zuerst und danach "Bubbling"</p>
        <img src="assets/Lesson03/eventflow.svg" style="max-width: 400px">
      </section>

      <section class="compact">
        <h1>Normale Reihenfolge</h1>
        <p>Elemente fangen Events in die "Bubbling" Phase ab.</p>
        <pre>
          <code data-trim class="language-javascript hljs">
            const log = e => console.log(e.currentTarget.nodeName);
            document.addEventListener("click", log);
            form.addEventListener("click", log);
            button.addEventListener("click", log);
          </code>
        </pre>
        <p>Bei einem Klick auf dem Button kommt:</p>
        <pre>
          <code data-trim class="language-text hljs">
            BUTTON
            FORM
            #document
          </code>
        </pre>
      </section>

      <section class="compact">
        <h1>Angepasste Reihenfolge</h1>
        <p>Elemente können in die "Capture" Phase Events abfangen.</p>
        <pre>
          <code data-trim class="language-javascript hljs">
            const log = e => console.log(e.currentTarget.nodeName);
            document.addEventListener("click", log, { capture: true });
            form.addEventListener("click", log);
            button.addEventListener("click", log);
          </code>
        </pre>
        <p>Bei einem Klick kommt:</p>
        <pre>
          <code data-trim class="language-text hljs">
            #document
            BUTTON
            FORM
          </code>
        </pre>
      </section>

      <section>
        <h1>Propagieren verhindern</h1>
        <ul>
          <li><code>stopPropagation()</code> bricht Event-Handling ab</li>
        </ul>
        <pre>
          <code data-trim class="language-javascript hljs">
            const log = e => {
              console.log(e.currentTarget.nodeName);
              e.stopPropagation();
            };
            document.addEventListener("click", log, { capture: true });
            form.addEventListener("click", log);
            button.addEventListener("click", log);
          </code>
        </pre>
        <p>Bei einem Klick kommt:</p>
        <pre>
          <code data-trim class="language-text hljs">
            #document
          </code>
        </pre>
      </section>

      <section>
        <h1>Default Verhalten</h1>
        <ul>
          <li><code>preventDefault()</code> unterdrückt das Default Verhalten des Browsers (z.B. Navigieren bei einem
            <code>a</code> Element)
          </li>
        </ul>
        <pre>
          <code data-trim class="language-html hljs">
            <a href="https://duckduckgo.com" id="search">DuckDuckGo</a>
          </code>
        </pre>
        <pre>
          <code data-trim class="language-javascript hljs">
            const duckDuckGo = document.getElementById("search");

            duckDuckGo.addEventListener("click", e => {
              if (!confirm("Are you sure?")) {
                e.preventDefault();
              }
            });
          </code>
        </pre>
      </section>

      <section>
        <div class="seventy-thirty-grid">
          <div>
            <h1>Ereignisse</h1>
            <ul>
              <li>Event Handlers</li>
              <li>Event Listeners</li>
              <li>Reihenfolge</li>
              <li>Propagieren verhindern</li>
              <li>Default verhindern</li>
            </ul>
          </div>
          <img src="assets/demo.png">
        </div>
      </section>

      <section>
        <h1>Fragen?</h1>
        <div class="fifty-fifty-grid">
          <img src="assets/okaaaay.jpg">
        </div>
      </section>

      <section>
        <div class="seventy-thirty-grid">
          <div>
            <h1>Übungen</h1>
            <ul>
              <li>Klick-Handler für ein Button schreiben</li>
              <li>Klick-Handler für ein Link schreiben</li>
            </ul>
          </div>
          <img src="assets/cog-wheels.png">
        </div>
      </section>

      <section class="compact">
        <h1 class="insertion"><a href="https://jestjs.io/docs/snapshot-testing">Jest Snapshots</a></h1>
        <ul>
          <li>Die Funktion <code>toMatchSnapshot()</code> speichert die Erwartung in einer Datei</li>
          <li>Beim ersten Ausführen wird die Datei einfach geschrieben</li>
        </ul>
        <pre>
          <code data-trim class="language-javascript hljs">
            test("initialize", async () => {
              const l = document.getElementById("l");
              await new application().initialize();
              expect(listItems.innerHTML).toMatchSnapshot(); // <-- Snapshot
            });
          </code>
        </pre>
      </section>

      <section>
        <h1 class="insertion"><a href="https://jestjs.io/docs/snapshot-testing">Updating Snapshots</a></h1>
        <ul>
          <li>Bei Änderungen schlägt der Test fehl</li>
          <li>Snapshots aktualisieren mit <code>jest -u</code> im Terminal</li>
          <li>WebStorm zeigt Links im Test-Runner an<br>
            <img src="assets/Lesson06/ws_jest_update_snapshot.png" class="screenshot">
          </li>
        </ul>
      </section>

    </div>
  </div>

  <script src="dist/reveal.js"></script>
  <script src="plugin/notes/notes.js"></script>
  <script src="plugin/markdown/markdown.js"></script>
  <script src="plugin/highlight/highlight.js"></script>
  <script>
    // More info about initialization & config:
    // - https://revealjs.com/initialization/
    // - https://revealjs.com/config/
    Reveal.initialize({
      hash: true,

      // Learn about plugins: https://revealjs.com/plugins/
      plugins: [RevealMarkdown, RevealHighlight, RevealNotes]
    });
  </script>
</body>

</html>